# Подробное описание сайта для учета в ОСББ/ЖК

## Общая информация

**Название:** Учет в ОСББ/ЖК  
**Назначение:** Веб-приложение для ведения бухгалтерского и абонентского учета в объединениях совладельцев многоквартирных домов (ОСББ) и жилищных кооперативах (ЖК)  
**Технологии:** HTML, CSS, JavaScript (Vanilla), Supabase (авторизация и хранение данных), PDF.js, ExcelJS

---

## Архитектура и структура

### Основные файлы

#### HTML файлы:
- **index.html** - главная страница приложения с авторизацией и основным интерфейсом
- **info.html** - информационная страница о бухгалтере (портфолио/визитка)

#### JavaScript модули:
- **menu.js** - управление боковым меню, навигацией, загрузкой данных домов
- **table.js** - формирование таблиц с начислениями и оплатами, фильтрация, сортировка
- **paytable.js** - таблица платежей с фильтрацией по датам
- **banktable.js** - банковские операции (приход/расход), фильтрация по типам операций
- **reports.js** - просмотр документов (PDF, Excel, изображения) с файловой структурой
- **homeinfo.js** - информация о доме, замена плейсхолдеров в документах
- **schema.js** - визуальная схема дома (подъезды, этажи, квартиры)
- **analiz.js** - аналитические отчеты по платежам и долгам
- **addstuf.js** - вспомогательные функции
- **ut.js** - утилиты

#### CSS файлы:
- **allLs.css** - основные стили
- **menu.css** - стили бокового меню
- **banktable.css** - стили банковской таблицы
- **reports.css** - стили для просмотра документов
- **print.css** - стили для печати
- **analiz.css** - стили аналитических таблиц
- **schema.css** - стили схемы дома
- **full_screen.css** - стили полноэкранного режима

---

## Функциональность

### 1. Система авторизации

- **Регистрация и вход** через Supabase Auth
- **Управление паролем** - возможность изменения пароля в настройках
- **Сессии** - автоматическое восстановление сессии при перезагрузке страницы
- **Выход** - кнопка выхода из системы

### 2. Управление домами

- **Множественные дома** - поддержка работы с несколькими ОСББ/ЖК одновременно
- **Поиск домов** - фильтрация домов по названию/адресу (появляется при количестве домов > 5)
- **Структурированное меню** - иерархическое меню: Дом → Действие

### 3. Основные разделы (действия для каждого дома)

#### 3.1. Особові рахунки (Лицевые счета)
- Детальная информация по каждому лицевому счету
- История начислений и оплат
- Расчет долга/переплаты
- Информация о владельце квартиры

#### 3.2. Перелік (Список/Таблица)
**Режимы отображения:**
- **По услугам** - сводная таблица с группировкой по видам услуг
- **По месяцам** - детальная разбивка по месяцам (начисления и оплаты)
- **По месяцам (начислено)** - только начисления
- **По месяцам (оплаты)** - только оплаты
- **По конкретной услуге** - фильтрация по выбранной услуге
- **Анализ** - аналитическая таблица с группировкой по должникам/переплатчикам

**Фильтры:**
- По периоду (текущий месяц, предыдущий, квартал, год, произвольный период)
- По статусу (все, оплатившие, должники, с переплатой, оплатившие или без долгов)
- По колонкам - текстовые фильтры с поддержкой:
  - Номеров квартир (множественный выбор через запятую/точку с запятой)
  - Текстовых значений (гибкий поиск с учетом вариантов букв)
  - Числовых значений (операторы >=, <=, >, <, диапазоны, не равно)

**Функции:**
- Сортировка по любой колонке (клик по заголовку)
- Подсветка долгов красным цветом
- Расчет месяцев долга (автоматический расчет на основе истории начислений)
- Переход к лицевому счету по клику на строку
- Экспорт в Excel
- Печать

#### 3.3. Платежі (Платежи)
- Таблица всех платежей за выбранный месяц
- Фильтрация по дням месяца (с/по)
- Информация о платеже:
  - Дата
  - Номер квартиры
  - Сумма
  - Назначение платежа (с подсветкой номера квартиры)
- Автоматическое определение текущего месяца (если сегодня ≤10, показывается предыдущий месяц)
- Сортировка по колонкам
- Предупреждение о необходимости указывать номер квартиры в назначении платежа

#### 3.4. Банк (Банковские операции)
**Типы операций:**
- Все операции
- Все без собственников
- Поступления (все)
- Поступления без собственников
- Расходы (все)
- Зарплата, налоги, под отчет
- Оплата поставщикам услуг
- Прочие расходы

**Фильтры:**
- По датам (с/по)
- По месяцу начисления (за какой месяц платеж)
- По типу операции
- Текстовый поиск (по контрагенту, назначению, описанию)

**Информация:**
- Остаток на начало периода
- Остаток на конец периода
- Итого получено/оплачено
- Детализация по каждой операции:
  - Дата
  - Сумма (зеленый - поступление, красный - расход)
  - За какой месяц
  - Контрагент
  - За что (назначение по коду)
  - Призначення платежу (полное описание)

#### 3.5. Документи (Документы)
**Структура файлов:**
- Организация по годам и месяцам
- Поддержка вложенных папок
- Автоматическое определение структуры

**Просмотр файлов:**
- **PDF** - встроенный просмотр через iframe, возможность скачать как PNG (для отправки в мессенджеры)
- **Excel** - просмотр через Office Online
- **Изображения** - встроенный просмотр
- **Прочие** - возможность скачать

**Функции:**
- Навигация по годам (кнопки)
- Навигация по месяцам (кнопки с украинскими названиями)
- Автоматическое открытие последнего просмотренного файла
- Отметка просмотренных файлов
- Скачивание с автоматическим переименованием (добавление префикса организации и даты)

#### 3.6. Інформація (Информация о доме)
- Отображение реквизитов ОСББ/ЖК:
  - Наименование
  - Код ЄДРПОУ
  - Адрес
  - Председатель/Руководитель
  - Контактная информация (телефон, email)
  - Банковские реквизиты (IBAN, банк)
  - Бухгалтер

**Дополнительные функции:**
- Замена плейсхолдеров в документах:
  - Поддержка форматов: DOCX, XLSX, TXT, XML
  - Drag & Drop загрузка файлов
  - Автоматическая замена `[ключ]` на значение из данных дома
  - Сохранение модифицированного файла

#### 3.7. Схема будинку (Схема дома)
**Визуализация:**
- Структура по подъездам
- Этажи (включая цокольный этаж, если есть)
- Квартиры на каждом этаже
- Стояки (вертикальные группы квартир)

**Режимы отображения:**
- Площадь
- Количество лицевых счетов
- Количество прописанных
- Количество квартир
- Долг (с цветовой индикацией: красный - большой долг, зеленый - переплата, черный - норма)
- Оплата за текущий месяц
- Начислено за текущий месяц

**Интерактивность:**
- Клик/долгое нажатие на квартиру - переход к лицевому счету
- Подсказки при наведении (информация о квартире и владельце)
- Итоги по этажам, стоякам, подъездам
- Общие итоги по дому

**Адаптивность:**
- Размер квартир пропорционален значению (для числовых показателей)
- Цветовая индикация долгов
- Поддержка мобильных устройств (touch-события)

---

## Технические особенности

### Хранение данных
- **Supabase** - база данных для хранения:
  - Список домов
  - Данные о домах (начисления, оплаты, лицевые счета, банковские операции)
  - Пользователи и авторизация

### Структура данных
- **Лицевые счета (ls)** - информация о квартирах и владельцах
- **Начисления (nach)** - структура: `accountId -> year -> month -> serviceId -> сумма`
- **Оплаты (oplat)** - структура: `accountId -> year -> month -> [массив платежей]`
- **Банковские операции (plat)** - структура: `year -> month -> [массив операций]`
- **Услуги (us)** - справочник услуг с кодами
- **Контрагенты (kto)** - справочник контрагентов
- **Назначения (what)** - справочник назначений платежей
- **Банки (b)** - справочник банков

### Расчеты
- **Начальный долг** - расчет на основе всех начислений и оплат до начала периода
- **Конечный долг** - начальный долг + начисления - оплаты за период
- **Месяцы долга** - интеллектуальный расчет на основе истории начислений:
  - Учитывает реальные суммы начислений по месяцам
  - Исключает определенные коды услуг в первых 3 месяцах (специфика учета)
  - Поддержка переплат (отрицательные месяцы)

### Интерфейс
- **Адаптивный дизайн** - поддержка мобильных устройств
- **Боковое меню** - выдвигающееся меню с поиском
- **История браузера** - поддержка кнопок "Назад/Вперед"
- **URL параметры** - сохранение состояния в URL для возможности поделиться ссылкой
- **Локальное хранилище** - сохранение настроек фильтров и последних просмотренных файлов

### Производительность
- **Кэширование данных** - данные дома загружаются один раз и кэшируются
- **Debounce** - задержка для текстовых фильтров
- **AbortController** - отмена предыдущих запросов при быстрой смене фильтров
- **Ленивая загрузка** - данные загружаются только при необходимости

### Безопасность
- **Авторизация** - доступ только для авторизованных пользователей
- **Row Level Security** - настройка прав доступа на уровне базы данных Supabase
- **Валидация данных** - проверка входных данных на клиенте

---

## Аналитические возможности

### Анализ платежей (analiz.js)
- Группировка по месяцам
- Разделение на категории:
  - **Всего по дому** - общие начисления, оплаты, процент оплаты
  - **Переплатники** - сумма переплаты, процент переплаты
  - **Должники** - квартиры с долгом > 3 месяцев, процент оплаты должников, количество и процент квартир-должников
- Сравнение периодов - возможность разделить данные на два периода и сравнить показатели
- Визуализация - гистограммы для сравнения "Было/Стало"

---

## Печать и экспорт

- **Печать** - специальные стили для печати (print.css)
- **Экспорт в Excel** - использование библиотеки ExcelJS
- **Экспорт PDF как изображения** - для отправки в мессенджеры (Viber/Telegram)
- **Сохранение файлов** - автоматическое переименование с префиксами

---

## Мобильная версия

- **Адаптивное меню** - гамбургер-меню для мобильных устройств
- **Touch-события** - поддержка долгого нажатия вместо клика
- **Оптимизация таблиц** - горизонтальная прокрутка для больших таблиц
- **Полноэкранный режим** - поддержка F11 и программного полноэкранного режима

---

## Интеграции

- **Supabase** - база данных и авторизация
- **PDF.js** - просмотр PDF файлов
- **ExcelJS** - работа с Excel файлами
- **Office Online** - просмотр Excel через Microsoft Office Online
- **docxtemplater** - замена плейсхолдеров в Word документах
- **FileSaver.js** - сохранение файлов на клиенте
- **html2canvas** - конвертация HTML в изображение

---

## Особенности реализации

### Умные фильтры
- Поддержка сложных условий (>=, <=, диапазоны)
- Множественный выбор для номеров квартир
- Гибкий текстовый поиск с учетом вариантов букв (I/И, Е/Э/є)

### Визуальная индикация
- Цветовая подсветка долгов (красный - долг, зеленый - переплата)
- Подсветка ячеек с отрицательными значениями
- Индикация просмотренных файлов
- Анимации при загрузке данных

### Удобство использования
- Автоматическое определение периода (текущий/предыдущий месяц)
- Восстановление последнего просмотренного файла
- Сохранение состояния фильтров
- Быстрый переход между разделами

---

## Целевая аудитория

- Бухгалтеры ОСББ/ЖК
- Председатели правления
- Управляющие компании
- Собственники квартир (ограниченный доступ)

---

## Преимущества системы

1. **Централизованное управление** - все данные в одном месте
2. **Автоматизация расчетов** - автоматический расчет долгов, переплат, месяцев долга
3. **Гибкая аналитика** - множество способов анализа данных
4. **Удобный просмотр документов** - встроенный просмотр без скачивания
5. **Мобильность** - работа с любого устройства
6. **Безопасность** - авторизация и разграничение доступа
7. **Масштабируемость** - поддержка множества домов

---

## Дополнительная информация

Сайт разработан для профессионального ведения учета в ОСББ/ЖК с учетом специфики украинского законодательства и практики работы с жилищно-коммунальными услугами.

---

## Предложения по улучшению и расширению функционала

### 1. Аналитика и отчетность

#### 1.1. Расширенная аналитика
- **Динамика платежей** - графики изменения платежной дисциплины по месяцам
- **Сравнение периодов** - детальное сравнение любых двух периодов с визуализацией
- **Прогнозирование** - прогноз поступления платежей на основе исторических данных
- **Топ должников** - автоматический список квартир с наибольшим долгом
- **Анализ услуг** - какие услуги оплачиваются лучше/хуже всего

#### 1.2. Автоматические отчеты
- **Еженедельные/месячные отчеты** - автоматическая генерация и отправка отчетов на email
- **Отчеты для правления** - специальные форматы отчетов для заседаний правления
- **Отчеты для собственников** - упрощенные отчеты для рассылки жильцам
- **Сравнительные отчеты** - сравнение показателей разных домов (для управляющих несколькими ОСББ)

#### 1.3. Экспорт и интеграция
- **Экспорт в различные форматы** - PDF, Excel, CSV с настраиваемыми шаблонами
- **Интеграция с 1С** - автоматический обмен данными с бухгалтерскими программами
- **API для внешних систем** - возможность интеграции с другими сервисами

### 2. Работа с должниками

#### 2.1. Автоматизация работы с задолженностью
- **Автоматические уведомления** - отправка напоминаний должникам (email, SMS, Viber/Telegram)
- **Генерация претензий** - автоматическое создание претензионных писем с подстановкой данных
- **План работы с должниками** - календарь мероприятий по взысканию задолженности
- **История взаимодействий** - журнал всех контактов с должником (звонки, письма, встречи)

#### 2.2. Реструктуризация долга
- **Калькулятор реструктуризации** - расчет графиков погашения долга
- **Договоры реструктуризации** - шаблоны и управление договорами
- **Контроль выполнения** - отслеживание соблюдения графика погашения

#### 2.3. Судебная работа
- **Подготовка документов для суда** - автоматическая генерация исковых заявлений
- **Отслеживание судебных дел** - статусы, даты заседаний, решения
- **Интеграция с судебными порталами** - автоматическая подача документов

### 3. Коммуникация с собственниками

#### 3.1. Личный кабинет собственника
- **Просмотр лицевого счета** - доступ собственника к своему счету (ограниченный)
- **История платежей** - все платежи с возможностью скачать квитанции
- **Электронные квитанции** - автоматическая генерация и отправка квитанций
- **Онлайн-оплата** - интеграция с платежными системами (LiqPay, Portmone)

#### 3.2. Уведомления и рассылки
- **Массовые рассылки** - отправка уведомлений всем или выбранным собственникам
- **Персонализированные сообщения** - индивидуальные уведомления с данными квартиры
- **Напоминания о платежах** - автоматические напоминания перед сроком оплаты
- **Информационные рассылки** - новости, объявления, протоколы собраний

#### 3.3. Обратная связь
- **Прием заявок** - система приема заявок от собственников (ремонт, вопросы)
- **Обращения** - учет и обработка обращений жильцов
- **Голосования** - проведение онлайн-голосований по вопросам ОСББ

### 4. Документооборот

#### 4.1. Управление документами
- **Версионирование** - хранение всех версий документов
- **Электронная подпись** - интеграция с системами электронной подписи
- **Шаблоны документов** - библиотека шаблонов (протоколы, решения, договоры)
- **Автоматическое заполнение** - подстановка данных в шаблоны документов

#### 4.2. Архив и поиск
- **Умный поиск** - полнотекстовый поиск по всем документам
- **Теги и категории** - организация документов по темам
- **Сроки хранения** - автоматическое напоминание о сроках хранения документов
- **Экспорт архива** - создание резервных копий документов

#### 4.3. Интеграция с ЕДО
- **Автоматический обмен** - получение/отправка документов через системы ЕДО
- **Синхронизация** - автоматическая синхронизация с внешними системами
- **Уведомления** - оповещения о новых документах из ЕДО

### 5. Финансовое планирование

#### 5.1. Бюджетирование
- **Планирование доходов и расходов** - создание и контроль бюджета
- **Сметы** - управление сметами на ремонты и работы
- **Факт vs План** - сравнение фактических показателей с плановыми
- **Прогнозирование** - прогноз финансового состояния на основе трендов

#### 5.2. Управление средствами
- **Резервные фонды** - учет и планирование резервных фондов
- **Целевые фонды** - управление целевыми накоплениями
- **Инвестиции** - учет инвестиций и их доходности
- **Кредиты и займы** - управление кредитными обязательствами

#### 5.3. Контроль расходов
- **Лимиты расходов** - установка лимитов по статьям расходов
- **Уведомления о превышении** - автоматические предупреждения
- **Анализ эффективности** - оценка эффективности расходов
- **Оптимизация** - рекомендации по оптимизации расходов

### 6. Управление домом

#### 6.1. Техническое обслуживание
- **Планово-предупредительный ремонт** - календарь и учет ППР
- **Заявки на ремонт** - система приема и обработки заявок
- **Учет работ** - ведение учета выполненных работ
- **Контроль качества** - оценка качества выполненных работ

#### 6.2. Договоры и контрагенты
- **База контрагентов** - расширенная информация о поставщиках услуг
- **Управление договорами** - учет договоров, сроков действия, продления
- **Напоминания** - автоматические напоминания о сроках договоров
- **Сравнение предложений** - сравнение условий разных поставщиков

#### 6.3. Общее имущество
- **Инвентаризация** - учет общего имущества дома
- **Амортизация** - расчет амортизации основных средств
- **Страхование** - учет страховых полисов и сроков действия
- **Кадастровый учет** - интеграция с кадастровыми данными

### 7. Улучшение пользовательского интерфейса

#### 7.1. Дашборды
- **Главная панель** - настраиваемая панель с ключевыми показателями
- **Виджеты** - различные виджеты для быстрого доступа к информации
- **Персонализация** - возможность настройки интерфейса под себя
- **Темная тема** - поддержка темной темы оформления

#### 7.2. Мобильное приложение
- **Нативное приложение** - iOS и Android приложения
- **Push-уведомления** - мгновенные уведомления на мобильные устройства
- **Офлайн-режим** - работа без интернета с синхронизацией
- **Быстрые действия** - быстрый доступ к часто используемым функциям

#### 7.3. Улучшение UX
- **Горячие клавиши** - поддержка клавиатурных сокращений
- **История действий** - журнал последних действий пользователя
- **Избранное** - возможность сохранять часто используемые отчеты/фильтры
- **Подсказки и обучение** - встроенные подсказки и обучающие материалы

### 8. Безопасность и контроль

#### 8.1. Расширенная безопасность
- **Двухфакторная аутентификация** - дополнительная защита аккаунтов
- **Аудит действий** - полный журнал всех действий пользователей
- **Роли и права доступа** - детальная настройка прав для разных ролей
- **IP-фильтрация** - ограничение доступа по IP-адресам

#### 8.2. Резервное копирование
- **Автоматические бэкапы** - регулярное создание резервных копий
- **Восстановление данных** - возможность восстановления из бэкапа
- **Версионирование данных** - хранение истории изменений
- **Экспорт данных** - возможность экспорта всех данных

#### 8.3. Соответствие требованиям
- **GDPR compliance** - соответствие требованиям защиты персональных данных
- **Аудит безопасности** - регулярные проверки безопасности
- **Шифрование** - шифрование чувствительных данных
- **Сертификация** - получение сертификатов соответствия

### 9. Интеграции

#### 9.1. Банковские системы
- **Интеграция с банками** - автоматическое получение выписок
- **Автоматическое распознавание платежей** - автоматическое зачисление платежей
- **Сверка с банком** - автоматическая сверка остатков
- **Мультибанкинг** - работа с несколькими банками

#### 9.2. Государственные системы
- **Интеграция с ПФУ** - обмен данными для субсидий
- **Интеграция с налоговой** - автоматическая подготовка отчетности
- **Единый реестр** - интеграция с государственными реестрами
- **Электронные сервисы** - интеграция с государственными электронными сервисами

#### 9.3. Внешние сервисы
- **Умные счетчики** - интеграция с системами учета ресурсов
- **Почтовые сервисы** - интеграция с почтовыми сервисами для рассылок
- **Мессенджеры** - интеграция с Telegram, Viber для уведомлений
- **Календари** - синхронизация с Google Calendar, Outlook

### 10. Аналитика и BI

#### 10.1. Расширенная аналитика
- **BI-панели** - интерактивные панели бизнес-аналитики
- **Многомерный анализ** - анализ данных по различным измерениям
- **Прогнозирование** - использование машинного обучения для прогнозов
- **Аномалии** - автоматическое обнаружение аномалий в данных

#### 10.2. Визуализация
- **Интерактивные графики** - графики с возможностью детализации
- **Геоаналитика** - визуализация данных на картах (для управляющих несколькими домами)
- **Сравнительные диаграммы** - сравнение показателей разных периодов/домов
- **Экспорт графиков** - сохранение графиков в различных форматах

#### 10.3. Отчеты
- **Конструктор отчетов** - создание собственных отчетов без программирования
- **Расписание отчетов** - автоматическая генерация отчетов по расписанию
- **Интерактивные отчеты** - отчеты с возможностью фильтрации и детализации
- **Шаблоны отчетов** - библиотека готовых шаблонов отчетов

### 11. Автоматизация процессов

#### 11.1. Автоматические задачи
- **Планировщик задач** - автоматическое выполнение задач по расписанию
- **Триггеры** - автоматические действия при наступлении событий
- **Workflow** - настройка бизнес-процессов
- **Уведомления** - автоматические уведомления о важных событиях

#### 11.2. Обработка данных
- **Автоматическое распознавание** - распознавание документов и данных
- **Валидация данных** - автоматическая проверка корректности данных
- **Очистка данных** - автоматическое исправление ошибок
- **Синхронизация** - автоматическая синхронизация с внешними системами

### 12. Специализированные функции

#### 12.1. Для бухгалтеров
- **Автоматизация проводок** - автоматическое создание бухгалтерских проводок
- **Сверка с контрагентами** - автоматическая сверка с поставщиками
- **Налоговая отчетность** - автоматическая подготовка налоговых отчетов
- **Зарплата** - расширенный модуль расчета зарплаты

#### 12.2. Для председателей
- **Панель управления** - специальная панель с ключевыми показателями
- **Быстрые отчеты** - часто используемые отчеты в один клик
- **Уведомления** - важные уведомления и напоминания
- **Календарь событий** - календарь важных событий и сроков

#### 12.3. Для собственников
- **Мобильное приложение** - упрощенное мобильное приложение для жильцов
- **Онлайн-оплата** - возможность оплаты через приложение
- **Заявки** - подача заявок на ремонт и вопросы
- **Голосования** - участие в голосованиях ОСББ

---

## Приоритеты внедрения

### Высокий приоритет (быстрая отдача)
1. Автоматические уведомления должникам
2. Экспорт в PDF/Excel с шаблонами
3. Личный кабинет собственника (базовая версия)
4. Дашборд с ключевыми показателями
5. Интеграция с банками для автоматического получения выписок

### Средний приоритет (среднесрочная перспектива)
1. Расширенная аналитика с графиками
2. Модуль работы с должниками
3. Система уведомлений и рассылок
4. Управление договорами
5. Мобильное приложение

### Низкий приоритет (долгосрочная перспектива)
1. BI-панели и продвинутая аналитика
2. Интеграция с государственными системами
3. Автоматизация судебной работы
4. Модуль финансового планирования
5. Интеграция с умными счетчиками

---

## Технические рекомендации

### Производительность
- **Кэширование** - расширенное кэширование часто используемых данных
- **Индексация** - оптимизация запросов к базе данных
- **Ленивая загрузка** - загрузка данных по требованию
- **CDN** - использование CDN для статических ресурсов

### Масштабируемость
- **Микросервисная архитектура** - разделение на независимые сервисы
- **Горизонтальное масштабирование** - возможность добавления серверов
- **Очереди задач** - использование очередей для фоновых задач
- **Балансировка нагрузки** - распределение нагрузки между серверами

### Надежность
- **Мониторинг** - отслеживание работы системы в реальном времени
- **Логирование** - детальное логирование всех операций
- **Обработка ошибок** - корректная обработка и уведомление об ошибках
- **Тестирование** - автоматизированное тестирование функционала

